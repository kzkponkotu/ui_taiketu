<!doctype html>
<html class="no-js" lang="ja" dir="ltr">
  <head>      
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Foundation for Sites</title>
    <link rel="stylesheet" href="css/foundation.css">
    <style>
    body {
        background-color: #F1F0EE;
        margin-left: 0px;
        margin-top: 0px;
        margin-right: 0px;
        margin-bottom: 0px;
        overflow-x: hidden;
        overflow-y: hidden;
    }

    .top-bar {
       background-color: #333333;
       color: #F1F0EE;
    }
    li {
       background-color: #333333;        
       color: #F1F0EE;       
    }
    .button {
        background-color: #1253A4;
        color: #F1F0EE;
    }
    span {
       background-color: #333333;        
       color: #F1F0EE;       
    }
    canvas {left:0;}
    </style>
    <audio class="piano" controls preload="auto" hidden>
        <source src="audio/8.mp3" type="audio/mp3">
    </audio>
    <audio class="piano" controls preload="auto" hidden>
        <source src="audio/7.mp3" type="audio/mp3">
    </audio>
    <audio class="piano" controls preload="auto" hidden>
        <source src="audio/6.mp3" type="audio/mp3">
    </audio>
    <audio class="piano" controls preload="auto" hidden>
        <source src="audio/5.mp3" type="audio/mp3">
    </audio>
    <audio class="piano" controls preload="auto" hidden>
        <source src="audio/4.mp3" type="audio/mp3">
    </audio>
    <audio class="piano" controls preload="auto" hidden>
        <source src="audio/3.mp3" type="audio/mp3">
    </audio>
    <audio class="piano" controls preload="auto" hidden>
        <source src="audio/2.mp3" type="audio/mp3">
    </audio>    
    <audio class="piano" controls preload="auto" hidden>
        <source src="audio/1.mp3" type="audio/mp3">
    </audio>
    <script src="./js/p5.min.js"></script>
    <script>
        var gakuhu = [];
        var kousi_w,kousi_h;
        var mouseDragged_flag = false;
        var doremi = ['ド','シ','ラ','ソ','ファ','ミ','レ','ド'];
        var page = 0;
        var audio = document.getElementsByClassName("piano");
        var renzoku_hantei_x = -1;
        var renzoku_hantei_y = -1;
        var saisei_doremi = [];
        var saisei_flag=false;
        function setup() {
            for(var i=0; i<100; i++){
                gakuhu[i] = [];            
                saisei_doremi[i] = [];
            }
            var ua = navigator.userAgent;
            if(ua.indexOf('iPhone') > 0 || ua.indexOf('iPod') > 0 || ua.indexOf('Android') > 0 && ua.indexOf('Mobile') > 0){
                //alert("スマホ");
                kousi_w = 4;
                kousi_h = 8;
            }else if(ua.indexOf('iPad') > 0 || ua.indexOf('Android') > 0){
                //alert("タブレット");
                kousi_w = 4;
                kousi_h = 8;
            }else{
                //alert("PC");
                kousi_w = 8;
                kousi_h = 8;
            }

            createCanvas(windowWidth, windowHeight-document.getElementsByClassName("top-bar")[0].clientHeight);
            for(var i=0; i<gakuhu.length; i++){
                for(var y=0; y<kousi_h; y++){
                    gakuhu[i][y] = [];
                    for(var x=0; x<kousi_w; x++){
                        gakuhu[i][y][x] = false;
                    }
                }
            }
        }

        function page_next() {
            page++;
        }

        function page_prev() {
            page--;
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight-document.getElementsByClassName("top-bar")[0].clientHeight);
        }

        function draw() {
            background(241,240,238);
            //stroke(18,83,164,255);
            //横線
            /*
            for(var i=0; i<kousi_h; i++){
                line(0,(height/kousi_h)*i,width,(height/kousi_h)*i);
            }
            */
            /*
            //縦線
            for(var i=0; i<kousi_w; i++){
                line((width/kousi_w)*i,0,(width/kousi_w)*i,height);
            }
            */
            fill(18,83,164,255);
            for(var i=0; i<kousi_h; i++){
                for(var j=0; j<kousi_w; j++){
                    ellipse((width/kousi_w)*i + ((width/kousi_w)/2),(height/kousi_h)*j+ ((height/kousi_h)/2),3,3);
                }
            }            

            //赤い四角とドレミファソラシドを書くよ
            for(var y=0; y<kousi_h; y++){
                for(var x=0; x<kousi_w; x++){
                    if(gakuhu[page][y][x]){
                        fill(242,105,100);
                        noStroke();
                        //triangle((width/kousi_w)*x,(height/kousi_h)*y,(width/kousi_w)*x + (width/kousi_w),(height/kousi_h)*y,((width/kousi_w)*x + (width/kousi_w))/2,((height/kousi_h)*y + (height/kousi_h)/2));
                        //ellipse((width/kousi_w)*x-((width/kousi_w)/2),(height/kousi_h)*y-((height/kousi_h)/2),100,100);
                        rect((width/kousi_w)*x+2,(height/kousi_h)*y+2,(width/kousi_w)-2,(height/kousi_h)-4);
                    }
                    fill(51,51,51,255*0.5);
                    noStroke();
                    var tiisaaihou1,tiisaaihou2,tiisize;
                    if(width < height)tiisaaihou1 = width;
                    tiisaaihou1 = height;
                    if(kousi_w < kousi_h)tiisaaihou2 = kousi_w;
                    else tiisaaihou2 = kousi_h;
                    tiisize = (tiisaaihou1/tiisaaihou2)/8;

                    textSize(tiisize);
                    if(y != 4)
                    text(doremi[y],(width/kousi_w)*x + ((width/kousi_w)/2)-(tiisize/2),(height/kousi_h)*(y+1)-5);
                    else
                    text(doremi[y],(width/kousi_w)*x + ((width/kousi_w)/2)-(tiisize),(height/kousi_h)*(y+1)-5);
                }
            }
        }

        //譜面入力
        function mouseClicked() {
            if(!mouseDragged_flag){
                for(var y=0; y<kousi_h; y++){
                    for(var x=0; x<kousi_w; x++){
                        if(mouseY >= (height/kousi_h)*y && mouseY <= (height/kousi_h)*(y+1)){
                            if(mouseX >= (width/kousi_w)*x && mouseX <= (width/kousi_w)*(x+1)){
                                if(!gakuhu[page][y][x])for(var i=0; i<kousi_h; i++)gakuhu[page][i][x] = false;                            
                                gakuhu[page][y][x] = !gakuhu[page][y][x];
                                if(gakuhu[page][y][x]){
                                    audio[y].currentTime = 0;
                                    audio[y].play();
                                    saisei_doremi[page][x] = y;                                    
                                }else{
                                    saisei_doremi[page][x] = null;
                                }
                            }
                        }
                    }
                }
            }
            mouseDragged_flag = false;
        }

        function mouseDragged() {
            for(var y=0; y<kousi_h; y++){
                for(var x=0; x<kousi_w; x++){
                    if(mouseY >= (height/kousi_h)*y && mouseY <= (height/kousi_h)*(y+1)){
                        if(mouseX >= (width/kousi_w)*x && mouseX <= (width/kousi_w)*(x+1)){
                            for(var i=0; i<kousi_h; i++)gakuhu[page][i][x] = false;
                            gakuhu[page][y][x] = !gakuhu[page][y][x];
                            mouseDragged_flag = true;
                            if(renzoku_hantei_y != y || renzoku_hantei_x != x){
                                audio[y].currentTime = 0;
                                audio[y].play();
                                saisei_doremi[page][x] = y;
                            }
                            renzoku_hantei_x = x;
                            renzoku_hantei_y = y;   
                        }
                    }
                }
            }
        }

        var musicplayer;

        function _music_play(num1,num2){
            page = num1;
            if(saisei_doremi[num1][num2] != null){
                audio[saisei_doremi[num1][num2]].pause();
                audio[saisei_doremi[num1][num2]].currentTime = 0;
                audio[saisei_doremi[num1][num2]].play();
            }

            num2++;
            if(num2 >= kousi_h){
                num2=0;
                num1++;
            }            
            musicplayer = setTimeout(function() {_music_play(num1,num2);}, 1100 - document.getElementById("speed").value );
        }

        function music_play(){
            saisei_flag = !saisei_flag;
            if(saisei_flag){
                for(var i=0; i<audio.length; i++){
                    audio[i].pause();
                    audio[i].currentTime = 0;
                }
                _music_play(0,0);
            }else{
                for(var i=0; i<audio.length; i++){
                    audio[i].pause();
                    audio[i].currentTime = 0;
                    clearTimeout(musicplayer);
                }
            }
        }        
    </script>
  </head>
  <body>
    <div class="top-bar">
    <div class="top-bar-left">
        <ul class="dropdown menu" data-dropdown-menu>
        <li class="menu-text">誰でも演奏できる君</li>
        </ul>
    </div>
    <div class="top-bar-right">
        <a href="#" id="prev" class="button" onclick="page_prev()">＜</a>
        <span id="page_num"></span><span>ページ目</span>
        <a href="#" id="saisei" class="button" onclick="music_play()">再生</a>
        再生速度:<input type="range" id="speed" step="1" min="100" max="1000">
        <a href="#" id="next" class="button" onclick="page_next()">＞</a>
    </div>    
    </div>      
    <script src="js/vendor/jquery.js"></script>
    <script src="js/vendor/what-input.js"></script>
    <script src="js/vendor/foundation.js"></script>
    <script src="js/app.js"></script>
    <script>
        setInterval(function(){
            if(page<=0)document.getElementById("prev").style.visibility="hidden";
            else document.getElementById("prev").style.visibility="visible";
            document.getElementById("page_num").innerHTML = page+1;
            if(saisei_flag)document.getElementById("saisei").innerHTML = "停止";
            else document.getElementById("saisei").innerHTML = "再生";
        },0);
    </script>    
  </body>
</html>
